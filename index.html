<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Full‑Auto PUT/CALL Paper Bot — 70% win bias</title>
<style>
  :root{--bg:#071026;--card:#071A2B;--txt:#E6EEF6;--muted:#9FB4C8;--ok:#22c55e;--warn:#f59e0b}
  *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,var(--bg),#05101a);color:var(--txt);font:14px Inter,system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:1100px;margin:20px auto;padding:16px}
  h1{margin:0 0 8px;font-size:20px}
  .card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);border-radius:12px;padding:12px;margin-bottom:12px}
  .row{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
  label{font-size:12px;color:var(--muted)}
  input,select,button{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:#071827;color:var(--txt)}
  button.primary{background:linear-gradient(90deg,#22d3ee,#3b82f6);border:0;color:#032;font-weight:700}
  .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04)}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left}
  .log{height:300px;overflow:auto;background:#02060a;border-radius:8px;padding:8px;font-family:ui-monospace,monospace}
</style>
</head>
<body>
<div class="wrap">
  <h1>Full‑Auto PUT/CALL — Paper Bot <span class="pill">70% win bias</span></h1>

  <div class="card">
    <div class="row">
      <div>
        <label>Stake</label>
        <input id="stake" type="number" step="0.01" value="1.00" />
      </div>
      <div>
        <label>Payout % (win)</label>
        <input id="payout" type="number" value="90" />
      </div>
      <div>
        <label>Target Win Rate %</label>
        <input id="targetWR" type="number" value="70" />
      </div>
      <div>
        <label>Duration (s)</label>
        <input id="duration" type="number" value="6" min="1" max="60" />
      </div>
      <div>
        <label>Max Concurrent</label>
        <input id="maxOpen" type="number" value="1" min="1" max="5" />
      </div>
      <div>
        <label>Cooldown (s)</label>
        <input id="cooldown" type="number" value="3" min="0" />
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <div>
        <label>Strategy combo</label>
        <select id="strategy">
          <option value="trend2,smart80" selected>Auto: Trend2 + Precision (selective)</option>
          <option value="trend2">Trend2 only</option>
          <option value="smart80">Precision only</option>
          <option value="random">Random trades only</option>
        </select>
      </div>
      <div>
        <label>Tick speed (ms)</label>
        <input id="tickms" type="number" value="400" min="100" />
      </div>
      <div>
        <label>Auto‑start</label>
        <select id="autostart"><option value="1" selected>Yes</option><option value="0">No</option></select>
      </div>
      <div>
        <label>Stop Loss ($)</label>
        <input id="sl" type="number" value="-100" />
      </div>
      <div>
        <label>Take Profit ($)</label>
        <input id="tp" type="number" value="100" />
      </div>
      <div>
        <label>&nbsp;</label>
        <button id="btnToggle" class="primary">Start</button>
      </div>
    </div>
  </div>

  <div class="card">
    <strong>Live Stats</strong>
    <div style="display:flex;gap:12px;margin-top:8px;align-items:center">
      <div class="pill">Virtual P/L: $<span id="pl">0.00</span></div>
      <div class="pill">Trades: <span id="trades">0</span></div>
      <div class="pill">Wins: <span id="wins">0</span></div>
      <div class="pill">Losses: <span id="losses">0</span></div>
      <div class="pill">Win%: <span id="wr">0%</span></div>
    </div>
  </div>

  <div class="card">
    <div style="display:grid;grid-template-columns:1fr 420px;gap:12px">
      <div>
        <strong>Open Positions</strong>
        <table id="tbl"><thead><tr><th>ID</th><th>Type</th><th>Stake</th><th>Open</th><th>Close</th><th>Result</th></tr></thead><tbody></tbody></table>
      </div>
      <div>
        <strong>Log</strong>
        <div class="log" id="log"></div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const $ = s=>document.querySelector(s);
  const logEl = $('#log');
  const fmt = n=>Number(n).toFixed(2);
  const addLog = (t)=> { logEl.textContent += new Date().toLocaleTimeString() + ' | ' + t + '\n'; logEl.scrollTop = logEl.scrollHeight; };

  // state
  const state = {
    ticks:[1000],
    candles:[],
    running:false,
    timer:null,
    open:new Map(),
    pl:0,
    wins:0, losses:0, trades:0,
    lastTradeTs:0,
    indicators:{ ema20:[], ema50:[], rsi14:[], atr14:[] }
  };

  // Helpers
  function nowMs(){ return Date.now(); }
  function pct(a,b){ return b? (100*a/b).toFixed(1) + '%' : '0%'; }

  // Simple indicators used by Precision strategy
  function emaSeries(values, period){ const k=2/(period+1); const out=[]; let e=null; for (let v of values){ e = e==null? v : (v - e)*k + e; out.push(e);} return out; }
  function rsiSeries(closes, period){ if (closes.length<=period) return Array(closes.length).fill(null); const out=Array(closes.length).fill(null); let gains=0,losses=0; for (let i=1;i<=period;i++){ const d=closes[i]-closes[i-1]; gains+=Math.max(d,0); losses+=Math.max(-d,0);} let avgG=gains/period, avgL=losses/period; out[period]=100-100/(1+(avgG/Math.max(avgL,1e-9))); for (let i=period+1;i<closes.length;i++){ const d=closes[i]-closes[i-1]; const g=Math.max(d,0), l=Math.max(-d,0); avgG=(avgG*(period-1)+g)/period; avgL=(avgL*(period-1)+l)/period; out[i]=100-100/(1+(avgG/Math.max(avgL,1e-9))); } return out; }
  function atrSeries(candles, period){ if (!candles.length) return []; const trs=[]; for (let i=0;i<candles.length;i++){ const c=candles[i]; if (i===0){ trs.push(c.high-c.low); continue;} const p=candles[i-1]; trs.push(Math.max(c.high-c.low, Math.abs(c.high-p.close), Math.abs(c.low-p.close))); } const out=[]; let atr=null; const k=2/(period+1); for (let t of trs){ atr = atr==null? t : (t-atr)*k + atr; out.push(atr);} return out; }

  function updateIndicators(){ const cs = state.candles; if (cs.length<10) return; const closes=cs.map(c=>c.close); state.indicators.ema20 = emaSeries(closes,20); state.indicators.ema50 = emaSeries(closes,50); state.indicators.rsi14 = rsiSeries(closes,14); state.indicators.atr14 = atrSeries(cs,14); }

  // Signal generators
  function signalTrend2(){ const n=state.ticks.length; if (n<3) return null; const a=state.ticks[n-3], b=state.ticks[n-2], c=state.ticks[n-1]; if (b>a && c>b) return 'CALL'; if (b<a && c<b) return 'PUT'; return null; }

  function signalPrecision(){ const cs = state.candles; if (cs.length<60) return null; updateIndicators(); const i = cs.length-2, i1=i-1; if (i1<1) return null; const e20 = state.indicators.ema20[i], e50=state.indicators.ema50[i], e20p=state.indicators.ema20[i1]; const atr = state.indicators.atr14[i]; const rsi = state.indicators.rsi14[i], rsiPrev = state.indicators.rsi14[i1]; if ([e20,e50,atr,rsi].some(v=>v==null)) return null; let buy=0,sell=0; if (e20>e50 && e20-e20p>0) buy++; if (e20<e50 && e20-e20p<0) sell++; const c = cs[i]; if (c.low<=e20 && c.close>e20 && c.close>c.open) buy++; if (c.high>=e20 && c.close<e20 && c.close<c.open) sell++; if ((rsiPrev<=50 && rsi>50) || (rsi>rsiPrev && rsi>=48 && rsi<=70)) buy++; if ((rsiPrev>=50 && rsi<50) || (rsi<rsiPrev && rsi<=52 && rsi>=30)) sell++; const atrPct = atr/Math.max(c.close,1e-9); if (atrPct>=0.0003 && atrPct<=0.02){ buy++; sell++; } if (Math.abs(c.close-e50)/c.close >= 0.0008){ buy++; sell++; } const MIN=4; if (buy>=MIN && buy>sell) return 'CALL'; if (sell>=MIN && sell>buy) return 'PUT'; return null; }

  // Trade engine (paper, biased outcome)
  let lastOrderTs = 0;
  function tryPlace(side){ const maxOpen = Number($('#maxOpen').value||1); const openCount = Array.from(state.open.values()).filter(o=>o.status==='OPEN').length; if (openCount>=maxOpen) return false; const cooldown = Number($('#cooldown').value||0)*1000; if (Date.now()-lastOrderTs < cooldown) return false; const stake = Number($('#stake').value||1); const dur = Number($('#duration').value||6); const id = Math.random().toString(36).slice(2,9).toUpperCase(); const tStart = new Date(); const tEnd = new Date(tStart.getTime()+dur*1000); state.open.set(id,{ id, type:side, stake, tStart, tEnd, status:'OPEN'}); upsertRow(state.open.get(id)); addLog('OPEN '+side+' $'+fmt(stake)+' id='+id); lastOrderTs = Date.now(); return true; }

  function upsertRow(o){ const tb=$('#tbl tbody'); const tr = document.getElementById('row-'+o.id); const row = `<tr id="row-${o.id}"><td>${o.id}</td><td>${o.type}</td><td>$${fmt(o.stake)}</td><td>${o.tStart.toLocaleTimeString()}</td><td>${o.tEnd.toLocaleTimeString()}</td><td>${o.status}</td></tr>`; if (tr) tr.outerHTML=row; else tb.insertAdjacentHTML('afterbegin',row); }

  function settleDue(){ const now=new Date(); for (const [id,o] of Array.from(state.open.entries())){ if (o.status!=='OPEN') continue; if (now>=o.tEnd){ const wr = Math.max(1, Math.min(99, Number($('#targetWR').value||70)))/100; const win = Math.random() < wr; const payoutPct = Math.max(1, Number($('#payout').value||90))/100; const pnl = win? o.stake*payoutPct : -o.stake; o.status = win? 'WIN' : 'LOSS'; state.pl += pnl; state.trades++; if (win) state.wins++; else state.losses++; upsertRow(o); addLog(`${o.id} ${o.type} → ${o.status} (${win?'+':''}${fmt(pnl)})`); updateStats(); setTimeout(()=>{ const tr=document.getElementById('row-'+id); tr && tr.remove(); state.open.delete(id); },1500); // TP/SL
        const tp = Number($('#tp').value||0), sl = Number($('#sl').value||0); if (tp && state.pl>=tp){ stop(); addLog('Take Profit reached. Stopping.'); } if (sl && state.pl<=sl){ stop(); addLog('Stop Loss reached. Stopping.'); } } } }

  function updateStats(){ $('#pl').textContent = fmt(state.pl); $('#wins').textContent = state.wins; $('#losses').textContent = state.losses; $('#trades').textContent = state.trades; $('#wr').textContent = pct(state.wins, state.trades); }

  // Tick generator: advance price & occasional candle pack
  function tick(){ // price random walk
    const last = state.ticks[state.ticks.length-1]; const step = (Math.random()-0.5)*0.8; const nxt = Math.max(100, last + step); state.ticks.push(nxt); if (state.ticks.length>500) state.ticks.shift(); // build pseudo-candle every N ticks
    if (Math.random()<0.18){ // occasionally add a candle
      const open = state.ticks[state.ticks.length-2] || nxt; const close = nxt; const high = Math.max(open, close) + Math.random()*0.6; const low = Math.min(open, close) - Math.random()*0.6; state.candles.push({ open, close, high, low, epoch:Date.now() }); if (state.candles.length>500) state.candles.shift(); updateIndicators(); }

    // Decide signals
    const combo = $('#strategy').value.split(','); let sign=null;
    for (const s of combo){ if (s==='trend2'){ sign = signalTrend2(); if (sign) break; } if (s==='smart80'){ sign = signalPrecision(); if (sign) break; } if (s==='random'){ if (Math.random()<0.02) sign = Math.random()<0.5? 'CALL':'PUT'; if (sign) break; } }

    if (sign){ tryPlace(sign); }

    settleDue();
  }

  function start(){ if (state.running) return; const ms = Math.max(100, Number($('#tickms').value||400)); state.timer = setInterval(tick, ms); state.running=true; $('#btnToggle').textContent='Stop'; addLog('Auto bot started'); }
  function stop(){ if (!state.running) return; clearInterval(state.timer); state.timer=null; state.running=false; $('#btnToggle').textContent='Start'; addLog('Auto bot stopped'); }

  $('#btnToggle').addEventListener('click', ()=>{ if (state.running) stop(); else start(); });

  // Auto-start if requested
  window.addEventListener('load', ()=>{ if ($('#autostart').value==='1'){ setTimeout(()=> start(), 500); } updateStats(); addLog('Ready.'); });

  // expose simple API for user: allow manual stop via console if needed
  window.__paperBot = { start, stop, state };

})();
</script>
</body>
</html>
